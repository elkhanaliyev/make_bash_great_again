#!/bin/bash

# Проверка на наличие двух аргументов (исходная и целевая директория)
if [ "$#" -ne 2 ]; then
  echo "Использование: $0 исходная_директория целевая_директория"
  exit 1
fi

# Присваиваем аргументы переменным
source_dir=$1
target_dir=$2
current_date=$(date +"%Y-%m-%d_%H-%M-%S")  # Получаем текущую дату и время

# Проверка, что исходная директория существует
if [ ! -d "$source_dir" ]; then
  echo "Ошибка: исходная директория '$source_dir' не существует!"
  exit 1
fi

# Проверка, что целевая директория существует, если нет — создаем ее
if [ ! -d "$target_dir" ]; then
  echo "Целевая директория '$target_dir' не существует, создаю..."
  mkdir -p "$target_dir"
fi

# Копирование всех файлов с добавлением даты в имя файла
for file in "$source_dir"/*; do
  if [ -f "$file" ]; then  # Проверка, что это файл, а не директория
    filename=$(basename "$file")  # Получаем имя файла
    cp "$file" "$target_dir/${filename%.*}_$current_date.${filename##*.}"  # Копирование с добавлением даты
  fi
done

echo "Резервное копирование завершено!"
